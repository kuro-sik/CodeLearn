{"version":3,"sources":["../../../../src/components/Gallery/hooks.ts"],"sourcesContent":["import * as React from 'react';\nimport { useStableCallback } from '../../hooks/useStableCallback';\nimport { useDOM } from '../../lib/dom';\nimport type { TimeoutId } from '../../types';\n\nexport interface AutoPlayConfig {\n  timeout: number;\n  slideIndex: number;\n  onNext: VoidFunction;\n}\n\nexport function useAutoPlay({ timeout, slideIndex, onNext }: AutoPlayConfig): {\n  pause: VoidFunction;\n  resume: VoidFunction;\n} {\n  const { document } = useDOM();\n  const [paused, setPaused] = React.useState(false);\n  const timeoutRef = React.useRef<TimeoutId>(null);\n  const callbackFn = useStableCallback(onNext);\n\n  const pause = React.useCallback(() => setPaused(true), []);\n  const resume = React.useCallback(() => setPaused(false), []);\n\n  // Выносим функции очистки и старта таймера в отдельные функции\n  const clearAutoPlayTimeout = React.useCallback(() => {\n    if (timeoutRef.current) {\n      clearTimeout(timeoutRef.current);\n      timeoutRef.current = null;\n    }\n  }, []);\n\n  const startAutoPlayTimeout = React.useCallback(() => {\n    if (!document || !timeout || paused) {\n      return;\n    }\n\n    if (document.visibilityState === 'visible') {\n      clearAutoPlayTimeout();\n      timeoutRef.current = setTimeout(callbackFn, timeout);\n    } else {\n      clearAutoPlayTimeout();\n    }\n  }, [document, timeout, paused, clearAutoPlayTimeout, callbackFn]);\n\n  // Основной эффект для управления автопроигрыванием\n  React.useEffect(\n    function initializeAutoPlay() {\n      if (!document || !timeout || paused) {\n        return;\n      }\n\n      startAutoPlayTimeout();\n      document.addEventListener('visibilitychange', startAutoPlayTimeout);\n\n      return () => {\n        clearAutoPlayTimeout();\n        document.removeEventListener('visibilitychange', startAutoPlayTimeout);\n      };\n    },\n    [document, timeout, slideIndex, startAutoPlayTimeout, clearAutoPlayTimeout, paused],\n  );\n\n  return {\n    resume,\n    pause,\n  };\n}\n"],"names":["useAutoPlay","timeout","slideIndex","onNext","document","useDOM","paused","setPaused","React","useState","timeoutRef","useRef","callbackFn","useStableCallback","pause","useCallback","resume","clearAutoPlayTimeout","current","clearTimeout","startAutoPlayTimeout","visibilityState","setTimeout","useEffect","initializeAutoPlay","addEventListener","removeEventListener"],"mappings":";;;;+BAWgBA;;;eAAAA;;;;iEAXO;mCACW;qBACX;AAShB,SAASA,YAAY,EAAEC,OAAO,EAAEC,UAAU,EAAEC,MAAM,EAAkB;IAIzE,MAAM,EAAEC,QAAQ,EAAE,GAAGC,IAAAA,WAAM;IAC3B,MAAM,CAACC,QAAQC,UAAU,GAAGC,OAAMC,QAAQ,CAAC;IAC3C,MAAMC,aAAaF,OAAMG,MAAM,CAAY;IAC3C,MAAMC,aAAaC,IAAAA,oCAAiB,EAACV;IAErC,MAAMW,QAAQN,OAAMO,WAAW,CAAC,IAAMR,UAAU,OAAO,EAAE;IACzD,MAAMS,SAASR,OAAMO,WAAW,CAAC,IAAMR,UAAU,QAAQ,EAAE;IAE3D,+DAA+D;IAC/D,MAAMU,uBAAuBT,OAAMO,WAAW,CAAC;QAC7C,IAAIL,WAAWQ,OAAO,EAAE;YACtBC,aAAaT,WAAWQ,OAAO;YAC/BR,WAAWQ,OAAO,GAAG;QACvB;IACF,GAAG,EAAE;IAEL,MAAME,uBAAuBZ,OAAMO,WAAW,CAAC;QAC7C,IAAI,CAACX,YAAY,CAACH,WAAWK,QAAQ;YACnC;QACF;QAEA,IAAIF,SAASiB,eAAe,KAAK,WAAW;YAC1CJ;YACAP,WAAWQ,OAAO,GAAGI,WAAWV,YAAYX;QAC9C,OAAO;YACLgB;QACF;IACF,GAAG;QAACb;QAAUH;QAASK;QAAQW;QAAsBL;KAAW;IAEhE,mDAAmD;IACnDJ,OAAMe,SAAS,CACb,SAASC;QACP,IAAI,CAACpB,YAAY,CAACH,WAAWK,QAAQ;YACnC;QACF;QAEAc;QACAhB,SAASqB,gBAAgB,CAAC,oBAAoBL;QAE9C,OAAO;YACLH;YACAb,SAASsB,mBAAmB,CAAC,oBAAoBN;QACnD;IACF,GACA;QAAChB;QAAUH;QAASC;QAAYkB;QAAsBH;QAAsBX;KAAO;IAGrF,OAAO;QACLU;QACAF;IACF;AACF"}